function getSqDist(i,t){var r=i.x-t.x,e=i.y-t.y,n=i.z-t.z;return r*r+e*e+n*n}function getSqSegDist(i,t,r){var e=t.x,n=t.y,s=t.z,u=r.x-e,f=r.y-n,p=r.z-s;if(0!==u||0!==f||0!==p){var l=((i.x-e)*u+(i.y-n)*f+(i.z-s)*p)/(u*u+f*f+p*p);l>1?(e=r.x,n=r.y,s=r.z):l>0&&(e+=u*l,n+=f*l,s+=p*l)}return(u=i.x-e)*u+(f=i.y-n)*f+(p=i.z-s)*p}function simplifyRadialDist(i,t){for(var r,e=i[0],n=[e],s=1,u=i.length;s<u;s++)getSqDist(r=i[s],e)>t&&(n.push(r),e=r);return e!==r&&n.push(r),n}function simplifyDPStep(i,t,r,e,n){for(var s,u=e,f=t+1;f<r;f++){var p=getSqSegDist(i[f],i[t],i[r]);p>u&&(s=f,u=p)}u>e&&(s-t>1&&simplifyDPStep(i,t,s,e,n),n.push(i[s]),r-s>1&&simplifyDPStep(i,s,r,e,n))}function simplifyDouglasPeucker(i,t){var r=i.length-1,e=[i[0]];return simplifyDPStep(i,0,r,t,e),e.push(i[r]),e}function simplify(i,t,r){if(i.length<=2)return i;var e=void 0!==t?t*t:1;return i=simplifyDouglasPeucker(i=r?i:simplifyRadialDist(i,e),e)}